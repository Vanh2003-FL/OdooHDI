<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- HDI Payroll Component Views -->
    <record id="hdi_payroll_component_tree" model="ir.ui.view">
        <field name="name">hdi.payroll.component.tree</field>
        <field name="model">hdi.payroll.component</field>
        <field name="arch" type="xml">
            <list string="Thành phần lương" default_order="sequence,component_type,name">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="code"/>
                <field name="component_type"/>
                <field name="category"/>
                <field name="calculation_method"/>
                <field name="base_amount" optional="show"/>
                <field name="percentage" optional="show"/>
                <field name="is_mandatory"/>
                <field name="is_taxable"/>
                <field name="is_active"/>
                <field name="company_id" groups="base.group_multi_company"/>
            </list>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_hdi_payroll_component" model="ir.actions.act_window">
        <field name="name">Thành phần lương</field>
        <field name="res_model">hdi.payroll.component</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_hdi_payroll_rule" model="ir.actions.act_window">
        <field name="name">Quy tắc lương</field>
        <field name="res_model">hdi.payroll.rule</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_hdi_payroll_structure" model="ir.actions.act_window">
        <field name="name">Cấu trúc lương</field>
        <field name="res_model">hdi.payroll.structure</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_hdi_employee_payroll_component" model="ir.actions.act_window">
        <field name="name">Thành phần lương nhân viên</field>
        <field name="res_model">hdi.employee.payroll.component</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="hdi_payroll_component_form" model="ir.ui.view">
        <field name="name">hdi.payroll.component.form</field>
        <field name="model">hdi.payroll.component</field>
        <field name="arch" type="xml">
            <form string="Thành phần lương">
                <header>
                    <field name="is_active" widget="boolean_button"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Tên thành phần lương"/>
                        </h1>
                        <h2>
                            <field name="code" placeholder="Mã thành phần lương"/>
                        </h2>
                    </div>
                    <group>
                        <group name="basic_info">
                            <field name="component_type"/>
                            <field name="category"/>
                            <field name="sequence"/>
                            <field name="frequency"/>
                        </group>
                        <group name="flags">
                            <field name="is_mandatory"/>
                            <field name="is_taxable"/>
                            <field name="is_social_insurance_base"/>
                            <field name="appears_on_payslip"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Tính toán" name="calculation">
                            <group>
                                <group name="calculation_method">
                                    <field name="calculation_method"/>
                                    <field name="base_amount" invisible="calculation_method not in ['fixed', 'hourly_rate']"/>
                                    <field name="percentage" invisible="calculation_method != 'percentage'"/>
                                    <field name="percentage_base" invisible="calculation_method != 'percentage'"/>
                                    <field name="proration_method"/>
                                </group>
                                <group name="limits">
                                    <field name="has_minimum_limit"/>
                                    <field name="minimum_amount" invisible="has_minimum_limit == False"/>
                                    <field name="has_maximum_limit"/>
                                    <field name="maximum_amount" invisible="has_maximum_limit == False"/>
                                </group>
                            </group>

                            <group name="formula" invisible="calculation_method != 'formula'">
                                <field name="formula" placeholder="Nhập công thức tính toán Python"/>
                            </group>

                            <group name="tiered" invisible="calculation_method != 'tiered'">
                                <field name="tier_line_ids" nolabel="1">
                                    <list editable="bottom">
                                        <field name="sequence" widget="handle"/>
                                        <field name="name"/>
                                        <field name="threshold_from"/>
                                        <field name="threshold_to"/>
                                        <field name="calculation_type"/>
                                        <field name="rate"/>
                                    </list>
                                </field>
                            </group>
                        </page>

                        <page string="Điều kiện" name="eligibility">
                            <group>
                                <field name="eligibility_criteria" placeholder="Mô tả tiêu chí đủ điều kiện"/>
                            </group>
                            <group>
                                <group name="departments">
                                    <field name="department_ids" widget="many2many_tags"/>
                                </group>
                                <group name="jobs">
                                    <field name="job_ids" widget="many2many_tags"/>
                                </group>
                            </group>
                        </page>

                        <page string="Kế toán" name="accounting">
                            <group>
                                <group name="accounts">
                                    <field name="account_debit"/>
                                    <field name="account_credit"/>
                                </group>
                                <group name="reporting">
                                    <field name="payslip_group"/>
                                    <field name="company_id" groups="base.group_multi_company"/>
                                    <field name="currency_id"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="hdi_payroll_component_search" model="ir.ui.view">
        <field name="name">hdi.payroll.component.search</field>
        <field name="model">hdi.payroll.component</field>
        <field name="arch" type="xml">
            <search string="Thành phần lương">
                <field name="name"/>
                <field name="code"/>
                <field name="component_type"/>
                <field name="category"/>
                <separator/>
                <filter name="earnings" string="Thu nhập" domain="[('component_type','=','earning')]"/>
                <filter name="deductions" string="Khấu trừ" domain="[('component_type','=','deduction')]"/>
                <filter name="benefits" string="Phúc lợi" domain="[('component_type','=','benefit')]"/>
                <filter name="mandatory" string="Bắt buộc" domain="[('is_mandatory','=',True)]"/>
                <filter name="active" string="Kích hoạt" domain="[('is_active','=',True)]"/>
                <group expand="0" string="Nhóm theo">
                    <filter string="Loại thành phần" name="group_type" domain="[]" context="{'group_by':'component_type'}"/>
                    <filter string="Danh mục" name="group_category" domain="[]" context="{'group_by':'category'}"/>
                    <filter string="Phương pháp tính toán" name="group_calculation" domain="[]" context="{'group_by':'calculation_method'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- HDI Payroll Rule Views -->
    <record id="hdi_payroll_rule_tree" model="ir.ui.view">
        <field name="name">hdi.payroll.rule.tree</field>
        <field name="model">hdi.payroll.rule</field>
        <field name="arch" type="xml">
            <list string="Quy tắc lương" default_order="sequence,rule_type,name">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="code"/>
                <field name="rule_type"/>
                <field name="is_active"/>
                <field name="appears_on_payslip"/>
                <field name="company_id" groups="base.group_multi_company"/>
            </list>
        </field>
    </record>

    <record id="hdi_payroll_rule_form" model="ir.ui.view">
        <field name="name">hdi.payroll.rule.form</field>
        <field name="model">hdi.payroll.rule</field>
        <field name="arch" type="xml">
            <form string="Quy tắc lương">
                <header>
                    <field name="is_active" widget="boolean_button"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Tên quy tắc"/>
                        </h1>
                        <h2>
                            <field name="code" placeholder="Mã quy tắc"/>
                        </h2>
                    </div>
                    <group>
                        <group name="basic_info">
                            <field name="rule_type"/>
                            <field name="sequence"/>
                            <field name="appears_on_payslip"/>
                        </group>
                        <group name="company">
                            <field name="company_id" groups="base.group_multi_company"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Thành phần" name="components">
                            <field name="component_ids">
                                <list>
                                    <field name="name"/>
                                    <field name="code"/>
                                    <field name="component_type"/>
                                    <field name="calculation_method"/>
                                    <field name="is_mandatory"/>
                                </list>
                            </field>
                        </page>

                        <page string="Điều kiện" name="conditions">
                            <group>
                                <field name="condition" placeholder="Biểu thức Python (ví dụ: contract.wage > 5000000)"/>
                            </group>
                        </page>

                        <page string="Tính toán" name="calculation">
                            <group>
                                <field name="calculation_formula" placeholder="Công thức tính toán Python"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- HDI Payroll Structure Views -->
    <record id="hdi_payroll_structure_tree" model="ir.ui.view">
        <field name="name">hdi.payroll.structure.tree</field>
        <field name="model">hdi.payroll.structure</field>
        <field name="arch" type="xml">
            <list string="Cấu trúc lương">
                <field name="name"/>
                <field name="code"/>
                <field name="is_active"/>
                <field name="company_id" groups="base.group_multi_company"/>
            </list>
        </field>
    </record>

    <record id="hdi_payroll_structure_form" model="ir.ui.view">
        <field name="name">hdi.payroll.structure.form</field>
        <field name="model">hdi.payroll.structure</field>
        <field name="arch" type="xml">
            <form string="Cấu trúc lương">
                <header>
                    <field name="is_active" widget="boolean_button"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Tên cấu trúc lương"/>
                        </h1>
                        <h2>
                            <field name="code" placeholder="Mã cấu trúc lương"/>
                        </h2>
                    </div>
                    <group>
                        <field name="company_id" groups="base.group_multi_company"/>
                    </group>

                    <notebook>
                        <page string="Quy tắc lương" name="rules">
                            <field name="rule_ids">
                                <list>
                                    <field name="sequence" widget="handle"/>
                                    <field name="name"/>
                                    <field name="code"/>
                                    <field name="rule_type"/>
                                    <field name="is_active"/>
                                </list>
                            </field>
                        </page>

                        <page string="Thành phần mặc định" name="components">
                            <field name="default_component_ids">
                                <list>
                                    <field name="name"/>
                                    <field name="code"/>
                                    <field name="component_type"/>
                                    <field name="calculation_method"/>
                                    <field name="base_amount"/>
                                </list>
                            </field>
                        </page>

                        <page string="Cấu trúc lương" name="salary_structures">
                            <field name="salary_structure_ids" readonly="1">
                                <list>
                                    <field name="name"/>
                                    <field name="code"/>
                                    <field name="grade"/>
                                    <field name="level"/>
                                    <field name="base_salary_min"/>
                                    <field name="base_salary_max"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- HDI Employee Payroll Component Views -->
    <record id="hdi_employee_payroll_component_tree" model="ir.ui.view">
        <field name="name">hdi.employee.payroll.component.tree</field>
        <field name="model">hdi.employee.payroll.component</field>
        <field name="arch" type="xml">
            <list string="Thành phần lương nhân viên" editable="top">
                <field name="employee_id"/>
                <field name="component_id"/>
                <field name="custom_amount"/>
                <field name="custom_percentage"/>
                <field name="date_from"/>
                <field name="date_to"/>
                <field name="is_active"/>
                <field name="is_temporary"/>
                <field name="reason"/>
            </list>
        </field>
    </record>

    <record id="hdi_employee_payroll_component_form" model="ir.ui.view">
        <field name="name">hdi.employee.payroll.component.form</field>
        <field name="model">hdi.employee.payroll.component</field>
        <field name="arch" type="xml">
            <form string="Thành phần lương nhân viên">
                <header>
                    <field name="is_active" widget="boolean_button"/>
                </header>
                <sheet>
                    <group>
                        <group name="employee_info">
                            <field name="employee_id"/>
                            <field name="component_id"/>
                            <field name="is_temporary"/>
                        </group>
                        <group name="override_values">
                            <field name="custom_amount"/>
                            <field name="custom_percentage"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                    </group>

                    <group>
                        <group name="validity">
                            <field name="date_from"/>
                            <field name="date_to"/>
                        </group>
                        <group name="approval">
                            <field name="approved_by_id"/>
                        </group>
                    </group>

                    <group>
                        <field name="reason" placeholder="Lý do điều chỉnh thành phần lương"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Wizard Views -->
    <record id="hdi_salary_adjustment_wizard_form" model="ir.ui.view">
        <field name="name">hdi.salary.adjustment.wizard.form</field>
        <field name="model">hdi.salary.adjustment.wizard</field>
        <field name="arch" type="xml">
            <form string="Trình điều chỉnh lương">
                <sheet>
                    <div class="oe_title">
                        <h1>Trình điều chỉnh lương</h1>
                    </div>

                    <group>
                        <group name="selection">
                            <field name="selection_mode" widget="radio"/>
                            <field name="employee_id" invisible="selection_mode != 'single'" required="selection_mode == 'single'"/>
                            <field name="contract_id" invisible="selection_mode != 'single'"/>
                            <field name="employee_ids" widget="many2many_tags" invisible="selection_mode != 'multiple'"/>
                            <field name="department_ids" widget="many2many_tags" invisible="selection_mode != 'department'"/>
                            <field name="job_ids" widget="many2many_tags" invisible="selection_mode != 'job_position'"/>
                        </group>
                        <group name="adjustment_info">
                            <field name="adjustment_type"/>
                            <field name="adjustment_method"/>
                            <field name="effective_date"/>
                            <field name="performance_rating" invisible="adjustment_type != 'performance'"/>
                        </group>
                    </group>

                    <group>
                        <group name="adjustment_values">
                            <field name="percentage_increase" invisible="adjustment_method != 'percentage'"/>
                            <field name="fixed_amount" invisible="adjustment_method not in ['fixed_amount', 'new_salary']"/>
                            <field name="new_structure_id" invisible="adjustment_method != 'structure_change'"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                        <group name="reason_group">
                            <field name="reason" placeholder="Lý do điều chỉnh lương" colspan="2"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Xem trước" name="preview">
                            <field name="preview_lines">
                                <list editable="top">
                                    <field name="selected"/>
                                    <field name="employee_id" readonly="1"/>
                                    <field name="current_salary" readonly="1"/>
                                    <field name="new_salary"/>
                                    <field name="adjustment_amount" readonly="1"/>
                                    <field name="adjustment_percentage" readonly="1"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>

                <footer>
                    <button name="action_preview_adjustments" string="Xem trước điều chỉnh" type="object" class="btn-primary"/>
                    <button name="action_create_adjustments" string="Tạo điều chỉnh" type="object" class="btn-success"/>
                    <button string="Hủy" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="hdi_contract_renewal_wizard_form" model="ir.ui.view">
        <field name="name">hdi.contract.renewal.wizard.form</field>
        <field name="model">hdi.contract.renewal.wizard</field>
        <field name="arch" type="xml">
            <form string="Trình gia hạn hợp đồng">
                <sheet>
                    <div class="oe_title">
                        <h1>Gia hạn hợp đồng</h1>
                    </div>

                    <group>
                        <group name="contract_info">
                            <field name="contract_id"/>
                            <field name="employee_id" readonly="1"/>
                            <field name="contract_type_id"/>
                        </group>
                        <group name="dates">
                            <field name="new_start_date"/>
                            <field name="new_end_date"/>
                        </group>
                    </group>

                    <group>
                        <group name="salary_section">
                            <field name="keep_salary"/>
                            <field name="new_wage" readonly="keep_salary == True"/>
                            <field name="salary_structure_id" readonly="keep_salary == True"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                        <group name="benefits_section">
                            <field name="keep_benefits"/>
                            <field name="benefit_package_ids" widget="many2many_tags" readonly="keep_benefits == True"/>
                        </group>
                    </group>
                </sheet>

                <footer>
                    <button name="action_renew_contract" string="Gia hạn hợp đồng" type="object" class="btn-primary"/>
                    <button string="Hủy" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="hdi_benefit_enrollment_wizard_form" model="ir.ui.view">
        <field name="name">hdi.benefit.enrollment.wizard.form</field>
        <field name="model">hdi.benefit.enrollment.wizard</field>
        <field name="arch" type="xml">
            <form string="Trình đăng ký phúc lợi">
                <sheet>
                    <div class="oe_title">
                        <h1>Đăng ký phúc lợi</h1>
                    </div>

                    <group>
                        <group name="employee_info">
                            <field name="employee_id"/>
                            <field name="contract_id"/>
                            <field name="enrollment_type"/>
                            <field name="effective_date"/>
                        </group>
                        <group name="coverage_info">
                            <field name="health_coverage"/>
                            <field name="dependent_count"/>
                            <field name="spouse_coverage"/>
                            <field name="children_coverage"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Gói phúc lợi" name="packages">
                            <group>
                                <field name="available_package_ids" widget="many2many_tags" readonly="1"/>
                                <field name="selected_package_ids" widget="many2many_tags"/>
                            </group>
                        </page>

                        <page string="Phúc lợi linh hoạt" name="flexible">
                            <group>
                                <field name="flexible_budget"/>
                                <field name="currency_id" invisible="1"/>
                            </group>
                            <field name="flexible_selections">
                                <list editable="bottom">
                                    <field name="benefit_type"/>
                                    <field name="description"/>
                                    <field name="amount"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>

                <footer>
                    <button name="action_enroll_benefits" string="Đăng ký phúc lợi" type="object" class="btn-primary"/>
                    <button string="Hủy" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="hdi_payroll_simulation_wizard_form" model="ir.ui.view">
        <field name="name">hdi.payroll.simulation.wizard.form</field>
        <field name="model">hdi.payroll.simulation.wizard</field>
        <field name="arch" type="xml">
            <form string="Trình mô phỏng lương">
                <sheet>
                    <div class="oe_title">
                        <h1>Mô phỏng lương</h1>
                    </div>

                    <group>
                        <group name="selection">
                            <field name="employee_ids" widget="many2many_tags"/>
                            <field name="department_ids" widget="many2many_tags"/>
                        </group>
                        <group name="period">
                            <field name="date_from"/>
                            <field name="date_to"/>
                        </group>
                    </group>

                    <group>
                        <group name="parameters">
                            <field name="include_overtime"/>
                            <field name="include_bonuses"/>
                            <field name="tax_simulation"/>
                        </group>
                        <group name="totals">
                            <field name="total_gross"/>
                            <field name="total_deductions"/>
                            <field name="total_net"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Kết quả mô phỏng" name="results">
                            <field name="simulation_lines">
                                <list>
                                    <field name="employee_id"/>
                                    <field name="gross_salary"/>
                                    <field name="total_deductions"/>
                                    <field name="net_salary"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                
                <footer>
                    <button name="action_run_simulation" string="Chạy mô phỏng" type="object" class="btn-primary"/>
                    <button string="Hủy" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

</odoo>