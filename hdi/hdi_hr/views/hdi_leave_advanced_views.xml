<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Leave Accrual Views -->
    <record id="hdi_leave_accrual_form_view" model="ir.ui.view">
        <field name="name">hdi.leave.accrual.form</field>
        <field name="model">hdi.leave.accrual</field>
        <field name="arch" type="xml">
            <form>
                  <header>
                      <button name="action_confirm" string="Xác nhận tích lũy" type="object" 
                          invisible="state != 'draft'" class="oe_highlight"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="display_name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="employee_id"/>
                            <field name="leave_type_id"/>
                            <field name="accrual_date"/>
                        </group>
                        <group>
                            <field name="accrual_reason"/>
                            <field name="accrued_days"/>
                            <field name="previous_balance"/>
                            <field name="new_balance"/>
                        </group>
                    </group>
                    <group string="Bản ghi liên quan">
                        <field name="allocation_id"/>
                        <field name="notes"/>
                    </group>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="hdi_leave_accrual_tree_view" model="ir.ui.view">
        <field name="name">hdi.leave.accrual.tree</field>
        <field name="model">hdi.leave.accrual</field>
        <field name="arch" type="xml">
            <list decoration-info="state=='draft'" decoration-success="state=='confirmed'">
                <field name="employee_id"/>
                <field name="leave_type_id"/>
                <field name="accrual_date"/>
                <field name="accrual_reason"/>
                <field name="accrued_days"/>
                <field name="new_balance"/>
                <field name="state" widget="badge"/>
            </list>
        </field>
    </record>

    <!-- Leave Policy Views -->
    <record id="hdi_leave_policy_form_view" model="ir.ui.view">
        <field name="name">hdi.leave.policy.form</field>
        <field name="model">hdi.leave.policy</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Tên chính sách nghỉ phép"/>
                        </h1>
                        <h2>
                            <field name="code" placeholder="Mã chính sách"/>
                        </h2>
                    </div>
                    <group>
                        <group>
                            <field name="is_active"/>
                            <field name="effective_date"/>
                            <field name="default_approval_levels"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Phạm vi áp dụng">
                            <group>
                                <field name="department_ids" widget="many2many_tags"/>
                                <field name="job_ids" widget="many2many_tags"/>
                                <field name="employee_category_ids" widget="many2many_tags"/>
                            </group>
                        </page>
                        <page string="Quy tắc loại nghỉ">
                            <field name="leave_type_rules">
                                <list editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="leave_type_id"/>
                                    <field name="entitlement_days"/>
                                    <field name="accrual_start_month"/>
                                    <field name="min_service_months"/>
                                </list>
                            </field>
                        </page>
                        <page string="Mô tả">
                            <field name="description" widget="html"/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="hdi_leave_policy_tree_view" model="ir.ui.view">
        <field name="name">hdi.leave.policy.tree</field>
        <field name="model">hdi.leave.policy</field>
        <field name="arch" type="xml">
            <list decoration-muted="not is_active">
                <field name="name"/>
                <field name="code"/>
                <field name="default_approval_levels"/>
                <field name="effective_date"/>
                <field name="is_active"/>
            </list>
        </field>
    </record>

    <!-- Leave Calendar Views -->
    <record id="hdi_leave_calendar_form_view" model="ir.ui.view">
        <field name="name">hdi.leave.calendar.form</field>
        <field name="model">hdi.leave.calendar</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Tên lịch"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="department_id"/>
                            <field name="working_days"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Ngày lễ">
                            <field name="holiday_ids">
                                <list editable="bottom">
                                    <field name="name"/>
                                    <field name="date"/>
                                    <field name="is_fixed"/>
                                    <field name="is_active"/>
                                </list>
                            </field>
                        </page>
                        <page string="Khoảng thời gian không nhận">
                            <field name="blackout_period_ids">
                                <list editable="bottom">
                                    <field name="name"/>
                                    <field name="date_from"/>
                                    <field name="date_to"/>
                                    <field name="leave_type_ids" widget="many2many_tags"/>
                                    <field name="is_active"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Leave Encashment Views -->
    <record id="hdi_leave_encashment_form_view" model="ir.ui.view">
        <field name="name">hdi.leave.encashment.form</field>
        <field name="model">hdi.leave.encashment</field>
        <field name="arch" type="xml">
            <form>
                  <header>
                      <button name="action_submit" string="Gửi phê duyệt" type="object"
                          invisible="state != 'draft'" class="oe_highlight"/>
                      <button name="action_approve" string="Phê duyệt" type="object"
                          invisible="state != 'submitted'" class="oe_highlight"/>
                      <button name="action_reject" string="Từ chối" type="object"
                          invisible="state != 'submitted'"/>
                      <field name="state" widget="statusbar"/>
                  </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            Yêu cầu quy đổi ngày phép
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="employee_id"/>
                            <field name="leave_type_id"/>
                            <field name="encashment_date"/>
                        </group>
                        <group>
                            <field name="currency_id" invisible="1"/>
                            <field name="available_balance"/>
                            <field name="days_to_encash"/>
                            <field name="remaining_balance"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Chi tiết tài chính">
                            <group>
                                <group>
                                    <field name="daily_rate"/>
                                    <field name="total_amount"/>
                                </group>
                            </group>
                        </page>
                        <page string="Chi tiết phê duyệt">
                            <group>
                                <group>
                                    <field name="approved_by_id"/>
                                    <field name="approval_date"/>
                                </group>
                            </group>
                            <group string="Ghi chú">
                                <field name="notes"/>
                                <field name="rejection_reason" invisible="state != 'rejected'"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="hdi_leave_encashment_tree_view" model="ir.ui.view">
        <field name="name">hdi.leave.encashment.tree</field>
        <field name="model">hdi.leave.encashment</field>
        <field name="arch" type="xml">
            <list decoration-info="state=='draft'" decoration-warning="state=='submitted'"
                  decoration-success="state in ['approved', 'paid']">
                <field name="employee_id"/>
                <field name="leave_type_id"/>
                <field name="encashment_date"/>
                <field name="days_to_encash"/>
                <field name="total_amount"/>
                <field name="state" widget="badge"/>
            </list>
        </field>
    </record>

    <!-- Extended HR Leave Type View - Add fields after existing groups -->
    <record id="hr_leave_type_form_hdi_view" model="ir.ui.view">
        <field name="name">hr.leave.type.form.hdi</field>
        <field name="model">hr.leave.type</field>
        <field name="inherit_id" ref="hr_holidays.edit_holiday_status_form"/>
        <field name="arch" type="xml">
            <!-- Add notebook if it doesn't exist, or add to existing one -->
            <xpath expr="//form/sheet" position="inside">
                <notebook>
                    <page string="Cài đặt HDI cho nghỉ phép" name="hdi_settings">
                        <group>
                            <group string="Cài đặt cơ bản">
                                <field name="hdi_code"/>
                                <field name="category"/>
                                <field name="accrual_method"/>
                            </group>
                            <group string="Cấu hình tích lũy">
                                <field name="monthly_accrual_rate" invisible="accrual_method != 'monthly'"/>
                                <field name="yearly_allocation" invisible="accrual_method != 'yearly'"/>
                                <field name="max_accumulation"/>
                            </group>
                        </group>
                        <group>
                            <group string="Quy tắc chuyển dời">
                                <field name="carry_forward_allowed"/>
                                <field name="carry_forward_limit" invisible="carry_forward_allowed == False"/>
                                <field name="carry_forward_expiry_months" invisible="carry_forward_allowed == False"/>
                            </group>
                            <group string="Luồng phê duyệt">
                                <field name="requires_approval"/>
                                <field name="approval_levels" invisible="requires_approval == False"/>
                                <field name="auto_approve_threshold" invisible="requires_approval == False"/>
                            </group>
                        </group>
                    </page>
                    <page string="Hạn chế &amp; Quy tắc" name="restrictions">
                        <group>
                            <group string="Hạn chế thời gian">
                                <field name="min_days_advance"/>
                                <field name="max_days_advance"/>
                                <field name="min_leave_duration"/>
                                <field name="max_leave_duration"/>
                            </group>
                            <group string="Giấy chứng nhận y tế">
                                <field name="requires_medical_certificate"/>
                                <field name="medical_certificate_threshold" invisible="requires_medical_certificate == False"/>
                            </group>
                        </group>
                        <group>
                            <group string="Cài đặt lịch">
                                <field name="exclude_weekends"/>
                                <field name="exclude_public_holidays"/>
                            </group>
                            <group string="Quy đổi">
                                <field name="encashment_allowed"/>
                                <field name="encashment_rate" invisible="encashment_allowed == False"/>
                                <field name="min_balance_for_encashment" invisible="encashment_allowed == False"/>
                            </group>
                        </group>
                    </page>
                </notebook>
            </xpath>
        </field>
    </record>

    <!-- Extended HR Leave View -->
    <record id="hr_leave_form_hdi_view" model="ir.ui.view">
        <field name="name">hr.leave.form.hdi</field>
        <field name="model">hr.leave</field>
        <field name="inherit_id" ref="hr_holidays.hr_leave_view_form"/>
        <field name="arch" type="xml">
            <!-- Try to add to existing notebook first -->
            <xpath expr="//form/sheet" position="inside">
                <notebook>
                    <page string="Chi tiết nghỉ phép HDI" name="hdi_details">
                        <group>
                            <group string="Thông tin mở rộng">
                                <field name="leave_category"/>
                                <field name="is_paid"/>
                                <field name="coverage_employee_id"/>
                            </group>
                            <group string="Liên hệ khẩn cấp">
                                <field name="emergency_contact"/>
                                <field name="emergency_phone"/>
                            </group>
                        </group>
                        <group>
                            <group string="Giấy chứng nhận y tế" invisible="medical_certificate_required == False">
                                <field name="medical_certificate_required" invisible="1"/>
                                <field name="medical_certificate" filename="medical_certificate_filename"/>
                                <field name="medical_certificate_filename" invisible="1"/>
                            </group>
                            <group string="Encashment" invisible="encashment_request == False">
                                <field name="encashment_request"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="encashment_amount" invisible="encashment_request == False"/>
                            </group>
                        </group>
                    </page>
                    <page string="Lịch sử phê duyệt" name="approval_history">
                        <field name="approval_history_ids">
                            <list>
                                <field name="approval_level"/>
                                <field name="approver_id"/>
                                <field name="action"/>
                                <field name="approval_date"/>
                                <field name="comments"/>
                            </list>
                        </field>
                    </page>
                </notebook>
            </xpath>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_hdi_leave_accrual" model="ir.actions.act_window">
        <field name="name">Tích lũy nghỉ phép</field>
        <field name="res_model">hdi.leave.accrual</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_hdi_leave_policy" model="ir.actions.act_window">
        <field name="name">Chính sách nghỉ phép</field>
        <field name="res_model">hdi.leave.policy</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_hdi_leave_calendar" model="ir.actions.act_window">
        <field name="name">Lịch nghỉ phép</field>
        <field name="res_model">hdi.leave.calendar</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_hdi_leave_encashment" model="ir.actions.act_window">
        <field name="name">Quy đổi ngày phép</field>
        <field name="res_model">hdi.leave.encashment</field>
        <field name="view_mode">list,form</field>
    </record>

</odoo>