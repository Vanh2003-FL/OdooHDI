<?xml version="1.0" encoding="UTF-8"?>
<templates>
    <!-- 2D LAYOUT DESIGNER Template - SKUsavvy Style -->
    <t t-name="hdi_warehouse_3d.warehouse_2d_designer">
        <div class="warehouse_designer_container">
            <!-- Compact Toolbar in Center Top (SKUsavvy style) -->
            <div class="designer_toolbar">
                <button class="btn btn-sm" 
                        t-att-class="state.mode === 'select' ? 'btn-primary' : 'btn-light'"
                        t-on-click="() => this.state.mode = 'select'">
                    Select
                </button>
                <button class="btn btn-sm"
                        t-att-class="state.mode === 'move' ? 'btn-primary' : 'btn-light'"
                        t-on-click="() => this.state.mode = 'move'">
                    Move
                </button>
                <button class="btn btn-sm"
                        t-att-class="state.mode === 'resize' ? 'btn-primary' : 'btn-light'"
                        t-on-click="() => this.state.mode = 'resize'">
                    Resize
                </button>
                <div style="width: 1px; height: 24px; background: #ddd; margin: 0 8px;"></div>
                <button class="btn btn-sm btn-success" t-on-click="() => this.createShelf()">
                    + Create Shelf
                </button>
                <button class="btn btn-sm btn-light" t-on-click="() => this.divideBins()">
                    Divide Bins
                </button>
                <button class="btn btn-sm btn-light" t-on-click="() => this.rotateShelf()">
                    Rotate Shelf
                </button>
                <button class="btn btn-sm btn-light" t-on-click="() => this.toggleGrid()">
                    Grid
                </button>
            </div>
            
            <!-- Top Right Controls (SKUsavvy: SAVE button) -->
            <div class="designer_controls_top_right">
                <button class="btn btn-primary" t-on-click="() => this.saveLayout()">
                    üíæ SAVE LAYOUT
                </button>
            </div>
            
            <!-- Zoom Controls Bottom Right (SKUsavvy style) -->
            <div class="designer_zoom_controls">
                <div class="zoom_btn" t-on-click="() => this.zoomIn()">+</div>
                <div class="zoom_btn" t-on-click="() => this.zoomOut()">‚àí</div>
            </div>
            
            <!-- Canvas Workspace (Full Screen) -->
            <div class="designer_workspace">
                <canvas t-ref="designerCanvas" id="designer_canvas"></canvas>
            </div>
            
            <!-- Properties Panel (Only when item selected) -->
            <div class="designer_properties" t-if="state.selectedItem">
                <h5 style="margin-bottom: 15px; font-weight: 600;">Properties</h5>
                <div style="margin-bottom: 10px;">
                    <small style="color: #666; text-transform: uppercase; font-weight: 600;">Type</small>
                    <div style="font-size: 14px; margin-top: 4px;" t-esc="state.selectedItem.type"/>
                </div>
                <div class="form-group mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control form-control-sm" t-model="state.selectedItem.data.name"/>
                </div>
                <div class="row mb-3">
                    <div class="col-6">
                        <label class="form-label">Position X</label>
                        <input type="number" class="form-control form-control-sm" 
                               t-model="state.selectedItem.data.position_x"/>
                    </div>
                    <div class="col-6">
                        <label class="form-label">Position Y</label>
                        <input type="number" class="form-control form-control-sm" 
                               t-model="state.selectedItem.data.position_y"/>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-6">
                        <label class="form-label">Width</label>
                        <input type="number" class="form-control form-control-sm" 
                               t-model="state.selectedItem.data.width"/>
                    </div>
                    <div class="col-6">
                        <label class="form-label">
                            <span t-if="state.selectedItem.type === 'shelf'">Depth</span>
                            <span t-else="">Height</span>
                        </label>
                        <input type="number" class="form-control form-control-sm" 
                               t-model="state.selectedItem.data.depth || state.selectedItem.data.height"/>
                    </div>
                </div>
                <button class="btn btn-primary btn-sm w-100" t-on-click="() => this.saveItemPosition(state.selectedItem)">
                    Save Changes
                </button>
            </div>
        </div>
    </t>

    <!-- 3D WAREHOUSE VIEWER Template (Operations - View &amp; Work) -->
    <t t-name="hdi_warehouse_3d.warehouse_3d_viewer">
        <div class="warehouse_viewer_container">
            <div class="viewer_toolbar">
                <h3>üì¶ 3D Warehouse Viewer</h3>
                <div class="btn-group">
                    <button class="btn btn-sm" 
                            t-att-class="state.viewMode === '2d' ? 'btn-primary' : 'btn-outline-primary'"
                            t-on-click="() => this.switchView('2d')">
                        üìê 2D View
                    </button>
                    <button class="btn btn-sm"
                            t-att-class="state.viewMode === '3d' ? 'btn-primary' : 'btn-outline-primary'"
                            t-on-click="() => this.switchView('3d')">
                        üéÆ 3D View
                    </button>
                </div>
                
                <div class="ms-3">
                    <select class="form-select form-select-sm" t-model="state.filterArea" t-on-change="() => this.loadWarehouseData()">
                        <option value="">All Areas</option>
                        <!-- Areas will be populated dynamically -->
                    </select>
                </div>
                
                <div class="btn-group ms-3">
                    <button class="btn btn-sm btn-outline-secondary" 
                            t-att-class="state.showEmpty ? 'active' : ''"
                            t-on-click="() => this.toggleEmptyBins()">
                        Show Empty
                    </button>
                    <button class="btn btn-sm btn-outline-secondary"
                            t-att-class="state.showBlocked ? 'active' : ''"
                            t-on-click="() => this.toggleBlockedBins()">
                        Show Blocked
                    </button>
                </div>
                
                <div class="ms-auto">
                    <span class="badge bg-info">üëÅÔ∏è View Mode - Operations Enabled</span>
                </div>
            </div>
            
            <div class="viewer_workspace">
                <canvas id="viewer_canvas"></canvas>
            </div>
            
            <div id="bin_detail_panel" class="bin_detail_panel"></div>
            
            <div class="viewer_legend">
                <h6>Legend:</h6>
                <div class="legend_item">
                    <span class="legend_color bin_empty"></span> Empty
                </div>
                <div class="legend_item">
                    <span class="legend_color bin_available"></span> Available
                </div>
                <div class="legend_item">
                    <span class="legend_color bin_full"></span> Full
                </div>
                <div class="legend_item">
                    <span class="legend_color bin_blocked"></span> Blocked
                </div>
            </div>
            
            <div class="viewer_help">
                <strong>‚úÖ 3D d√πng khi n√†o?</strong> Nh·∫≠p kho | Xu·∫•t kho | Ki·ªÉm tra t·ªìn | Audit<br/>
                <strong>üìä 3D lu√¥n d·ª±a tr√™n d·ªØ li·ªáu th·ª±c (stock.quant)</strong><br/>
                <strong>‚úÖ Allowed:</strong> Click bin, G√°n h√†ng (putaway), Di chuy·ªÉn h√†ng, Block/Unblock bin<br/>
                <strong>‚ùå NOT Allowed:</strong> K√©o k·ªá, Th√™m bin, ƒê·ªïi k√≠ch th∆∞·ªõc ‚Üí Use 2D Designer<br/>
                <strong>üìå Key:</strong> Edit 3D = Thao t√°c stock.quant, KH√îNG c√≥ b·∫£ng t·ªìn ri√™ng, 3D ch·ªâ l√† renderer
            </div>
        </div>
    </t>
    
    <!-- 3D PUTAWAY WIZARD for Incoming Picking -->
    <t t-name="hdi_warehouse_3d.warehouse_3d_putaway_wizard">
        <div class="warehouse_putaway_wizard">
            <!-- Header -->
            <div class="putaway_header">
                <div>
                    <h3>üèóÔ∏è 3D Putaway Assistant</h3>
                    <p class="text-muted">
                        Picking: <strong t-esc="state.picking?.name"/>
                        | Scheduled: <t t-esc="state.picking?.scheduled_date"/>
                    </p>
                </div>
                <button class="btn btn-secondary" t-on-click="() => this.closeWizard()">
                    Close
                </button>
            </div>

            <div class="putaway_body">
                <!-- Left Panel: Move Lines -->
                <div class="putaway_move_lines">
                    <h5>üì¶ Products to Put Away</h5>
                    <div class="move_line_list">
                        <div t-foreach="state.moveLines" t-as="ml" t-key="ml.id"
                             class="move_line_item"
                             t-att-class="state.selectedMoveLine?.id === ml.id ? 'selected' : ''"
                             t-on-click="() => this.selectMoveLine(ml)">
                            <div class="move_line_info">
                                <strong t-esc="ml.product_id[1]"/>
                                <div class="text-muted small">
                                    <span t-if="ml.lot_name">Lot: <t t-esc="ml.lot_name"/> | </span>
                                    Qty: <t t-esc="ml.reserved_uom_qty"/> <t t-esc="ml.product_uom_id[1]"/>
                                </div>
                            </div>
                            <div class="move_line_status">
                                <span t-if="ml.warehouse_bin_assigned" class="badge bg-success">
                                    ‚úì <t t-esc="ml.assigned_bin_id[1]"/>
                                </span>
                                <span t-else="" class="badge bg-warning">
                                    Pending
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 alert alert-info">
                        <strong>üìå How it works:</strong><br/>
                        1. Select a product<br/>
                        2. Click a bin in warehouse view<br/>
                        3. Confirm assignment<br/>
                        4. Close and validate picking normally
                    </div>
                </div>

                <!-- Center: Warehouse Canvas -->
                <div class="putaway_warehouse">
                    <div class="warehouse_controls">
                        <select class="form-select form-select-sm" t-model="state.filterArea" 
                                t-on-change="() => this.loadWarehouseData()">
                            <option value="">All Areas</option>
                            <!-- Areas populated dynamically -->
                        </select>
                        
                        <span t-if="state.selectedMoveLine" class="badge bg-primary">
                            Assigning: <t t-esc="state.selectedMoveLine.product_id[1]"/>
                        </span>
                    </div>
                    
                    <canvas id="putaway_canvas" width="800" height="600"></canvas>
                    
                    <div class="canvas_legend">
                        <div><span class="color_box bin_empty"></span> Empty</div>
                        <div><span class="color_box bin_available"></span> Available</div>
                        <div><span class="color_box bin_full"></span> Full</div>
                        <div><span class="color_box" style="background: #FFD700;"></span> Selected</div>
                    </div>
                </div>

                <!-- Right Panel: Bin Detail -->
                <div class="putaway_bin_detail" id="putaway_bin_detail">
                    <div class="text-center text-muted">
                        <p>üëà Select product, then click bin</p>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="putaway_footer">
                <div class="footer_info">
                    <strong>Progress:</strong>
                    <t t-set="assigned" t-value="state.moveLines.filter(ml => ml.warehouse_bin_assigned).length"/>
                    <t t-set="total" t-value="state.moveLines.length"/>
                    <span class="badge bg-info"><t t-esc="assigned"/> / <t t-esc="total"/> assigned</span>
                </div>
                <div class="footer_actions">
                    <button class="btn btn-primary" t-on-click="() => this.closeWizard()">
                        ‚úÖ Done - Return to Picking
                    </button>
                </div>
            </div>
        </div>
    </t>

    <!-- UNIFIED WAREHOUSE VIEW with 2D/3D Toggle -->
    <t t-name="hdi_warehouse_3d.warehouse_unified_view">
        <div class="warehouse_unified_container">
            <!-- Toggle Switch Header -->
            <div class="unified_header">
                <div class="mode_toggle_container">
                    <div class="mode_toggle">
                        <button 
                            class="toggle_btn"
                            t-att-class="state.mode === '2d' ? 'active' : ''"
                            t-on-click="() => this.switchTo2D()">
                            2D
                        </button>
                        <button 
                            class="toggle_btn"
                            t-att-class="state.mode === '3d' ? 'active' : ''"
                            t-on-click="() => this.switchTo3D()">
                            3D
                        </button>
                        <div class="toggle_slider" t-att-class="state.mode === '3d' ? 'right' : 'left'"></div>
                    </div>
                </div>
                
                <div class="mode_description">
                    <span t-if="state.mode === '2d'" class="badge bg-warning">
                        üèóÔ∏è Design Mode: Edit layout structure
                    </span>
                    <span t-if="state.mode === '3d'" class="badge bg-info">
                        üì¶ Operations Mode: Work with inventory
                    </span>
                </div>
            </div>

            <!-- Content Area -->
            <div class="unified_content">
                <!-- 2D Designer View -->
                <div t-if="state.mode === '2d'" class="mode_content">
                    <t t-if="!state.isManager">
                        <div class="alert alert-warning text-center">
                            <h4>‚ö†Ô∏è Access Restricted</h4>
                            <p>2D Designer mode requires Stock Manager permissions.</p>
                            <p>Contact your administrator to grant access.</p>
                        </div>
                    </t>
                    <t t-else="">
                        <!-- Embed 2D Designer Component -->
                        <div class="embedded_2d_designer">
                            <Warehouse2DDesigner t-props="state"/>
                        </div>
                    </t>
                </div>

                <!-- 3D Viewer View -->
                <div t-if="state.mode === '3d'" class="mode_content">
                    <!-- Embed 3D Viewer Component -->
                    <div class="embedded_3d_viewer">
                        <Warehouse3DViewer t-props="state"/>
                    </div>
                </div>
            </div>
        </div>
    </t>
</templates>
