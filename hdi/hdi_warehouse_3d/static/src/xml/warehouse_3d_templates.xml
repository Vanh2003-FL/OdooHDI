<?xml version="1.0" encoding="UTF-8"?>
<templates>
    <!-- 2D LAYOUT DESIGNER Template (Admin only - Design mode) -->
    <t t-name="hdi_warehouse_3d.warehouse_2d_designer">
        <div class="warehouse_designer_container">
            <div class="designer_toolbar">
                <h3>üèóÔ∏è 2D Layout Designer</h3>
                <div class="btn-group">
                    <button class="btn btn-sm btn-secondary" t-on-click="() => this.state.mode = 'select'">
                        üîç Select
                    </button>
                    <button class="btn btn-sm btn-primary" t-on-click="() => this.state.mode = 'move'">
                        ‚ÜîÔ∏è Move
                    </button>
                    <button class="btn btn-sm btn-info" t-on-click="() => this.state.mode = 'resize'">
                        ‚ÜîÔ∏è‚ÜïÔ∏è Resize
                    </button>
                </div>
                <div class="btn-group ms-3">
                    <button class="btn btn-sm btn-success" t-on-click="() => this.createShelf()">
                        ‚ûï Create Shelf
                    </button>
                    <button class="btn btn-sm btn-warning" t-on-click="() => this.divideBins()">
                        ‚äû Divide Bins
                    </button>
                    <button class="btn btn-sm btn-info" t-on-click="() => this.rotateShelf()">
                        üîÑ Rotate Shelf
                    </button>
                </div>
                <div class="btn-group ms-3">
                    <button class="btn btn-sm btn-outline-secondary" t-on-click="() => this.zoomIn()">
                        üîç+ Zoom In
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" t-on-click="() => this.zoomOut()">
                        üîç- Zoom Out
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" t-on-click="() => this.toggleGrid()">
                        ‚äû Grid
                    </button>
                </div>
                <div class="ms-auto d-flex gap-2">
                    <button class="btn btn-sm btn-primary" t-on-click="() => this.saveLayout()">
                        üíæ SAVE LAYOUT
                    </button>
                    <span class="badge bg-warning">‚ö†Ô∏è Design Mode - Inventory = 0 or 1M ‚Üí Same View</span>
                </div>
            </div>
            
            <div class="designer_workspace">
                <canvas t-ref="designerCanvas" id="designer_canvas"></canvas>
            </div>
            
            <div class="designer_properties" t-if="state.selectedItem">
                <h5>Properties</h5>
                <p><strong>Type:</strong> <span t-esc="state.selectedItem.type"/></p>
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" class="form-control" t-model="state.selectedItem.name"/>
                </div>
                <div class="form-group" t-if="state.selectedItem.type === 'area'">
                    <label>Area Type:</label>
                    <select class="form-select" t-model="state.selectedItem.area_type">
                        <option value="inbound">Inbound</option>
                        <option value="storage">Storage</option>
                        <option value="outbound">Outbound</option>
                        <option value="staging">Staging</option>
                        <option value="quality">Quality Check</option>
                    </select>
                </div>
                <div class="row">
                    <div class="col-6">
                        <label>Position X:</label>
                        <input type="number" class="form-control" t-model="state.selectedItem.position_x"/>
                    </div>
                    <div class="col-6">
                        <label>Position Y:</label>
                        <input type="number" class="form-control" t-model="state.selectedItem.position_y"/>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-6">
                        <label>Width:</label>
                        <input type="number" class="form-control" t-model="state.selectedItem.width"/>
                    </div>
                    <div class="col-6">
                        <label>Height:</label>
                        <input type="number" class="form-control" t-model="state.selectedItem.height"/>
                    </div>
                </div>
                <div class="form-group mt-2" t-if="state.selectedItem.type === 'shelf'">
                    <label>Orientation:</label>
                    <select class="form-select" t-model="state.selectedItem.orientation">
                        <option value="horizontal">Horizontal</option>
                        <option value="vertical">Vertical</option>
                    </select>
                </div>
                <div class="form-group mt-2" t-if="state.selectedItem.type === 'shelf'">
                    <label>Bins per Level:</label>
                    <input type="number" class="form-control" t-model="state.selectedItem.bins_per_level"/>
                </div>
                <button class="btn btn-primary btn-sm mt-3 w-100" t-on-click="() => this.saveItemPosition(state.selectedItem)">
                    üíæ Save Changes
                </button>
            </div>
            
            <div class="designer_help">
                <strong>‚úÖ Khi n√†o d√πng Edit 2D?</strong><br/>
                ‚Ä¢ Setup kho ban ƒë·∫ßu | M·ªü r·ªông kho | Th√™m k·ªá/bin | Chia l·∫°i l·ªëi ƒëi<br/>
                <strong>üìå Key Rule:</strong> T·ªìn kho = 0 hay 1M s·∫£n ph·∫©m ‚Üí Edit 2D v·∫´n gi·ªëng nhau (NO inventory dependency)<br/>
                <strong>üíæ SAVE ‚Üí What happens?</strong><br/>
                ‚Ä¢ Persist: Area ‚Üí Shelf ‚Üí Bin (map 1-1 v·ªõi stock.location)<br/>
                ‚Ä¢ NOT touched: stock.quant inventory data<br/>
                <strong>‚úÖ Allowed:</strong> Thi·∫øt k·∫ø layout, k√©o th·∫£, xoay, chia bin theo grid, set dimensions<br/>
                <strong>‚ùå NOT Allowed:</strong> G√°n h√†ng v√†o bin (use 3D Viewer)
            </div>
        </div>
    </t>

    <!-- 3D WAREHOUSE VIEWER Template (Operations - View &amp; Work) -->
    <t t-name="hdi_warehouse_3d.warehouse_3d_viewer">
        <div class="warehouse_viewer_container">
            <div class="viewer_toolbar">
                <h3>üì¶ 3D Warehouse Viewer</h3>
                <div class="btn-group">
                    <button class="btn btn-sm" 
                            t-att-class="state.viewMode === '2d' ? 'btn-primary' : 'btn-outline-primary'"
                            t-on-click="() => this.switchView('2d')">
                        üìê 2D View
                    </button>
                    <button class="btn btn-sm"
                            t-att-class="state.viewMode === '3d' ? 'btn-primary' : 'btn-outline-primary'"
                            t-on-click="() => this.switchView('3d')">
                        üéÆ 3D View
                    </button>
                </div>
                
                <div class="ms-3">
                    <select class="form-select form-select-sm" t-model="state.filterArea" t-on-change="() => this.loadWarehouseData()">
                        <option value="">All Areas</option>
                        <!-- Areas will be populated dynamically -->
                    </select>
                </div>
                
                <div class="btn-group ms-3">
                    <button class="btn btn-sm btn-outline-secondary" 
                            t-att-class="state.showEmpty ? 'active' : ''"
                            t-on-click="() => this.toggleEmptyBins()">
                        Show Empty
                    </button>
                    <button class="btn btn-sm btn-outline-secondary"
                            t-att-class="state.showBlocked ? 'active' : ''"
                            t-on-click="() => this.toggleBlockedBins()">
                        Show Blocked
                    </button>
                </div>
                
                <div class="ms-auto">
                    <span class="badge bg-info">üëÅÔ∏è View Mode - Operations Enabled</span>
                </div>
            </div>
            
            <div class="viewer_workspace">
                <canvas id="viewer_canvas"></canvas>
            </div>
            
            <div id="bin_detail_panel" class="bin_detail_panel"></div>
            
            <div class="viewer_legend">
                <h6>Legend:</h6>
                <div class="legend_item">
                    <span class="legend_color bin_empty"></span> Empty
                </div>
                <div class="legend_item">
                    <span class="legend_color bin_available"></span> Available
                </div>
                <div class="legend_item">
                    <span class="legend_color bin_full"></span> Full
                </div>
                <div class="legend_item">
                    <span class="legend_color bin_blocked"></span> Blocked
                </div>
            </div>
            
            <div class="viewer_help">
                <strong>‚úÖ 3D d√πng khi n√†o?</strong> Nh·∫≠p kho | Xu·∫•t kho | Ki·ªÉm tra t·ªìn | Audit<br/>
                <strong>üìä 3D lu√¥n d·ª±a tr√™n d·ªØ li·ªáu th·ª±c (stock.quant)</strong><br/>
                <strong>‚úÖ Allowed:</strong> Click bin, G√°n h√†ng (putaway), Di chuy·ªÉn h√†ng, Block/Unblock bin<br/>
                <strong>‚ùå NOT Allowed:</strong> K√©o k·ªá, Th√™m bin, ƒê·ªïi k√≠ch th∆∞·ªõc ‚Üí Use 2D Designer<br/>
                <strong>üìå Key:</strong> Edit 3D = Thao t√°c stock.quant, KH√îNG c√≥ b·∫£ng t·ªìn ri√™ng, 3D ch·ªâ l√† renderer
            </div>
        </div>
    </t>
    
    <!-- 3D PUTAWAY WIZARD for Incoming Picking -->
    <t t-name="hdi_warehouse_3d.warehouse_3d_putaway_wizard">
        <div class="warehouse_putaway_wizard">
            <!-- Header -->
            <div class="putaway_header">
                <div>
                    <h3>üèóÔ∏è 3D Putaway Assistant</h3>
                    <p class="text-muted">
                        Picking: <strong t-esc="state.picking?.name"/>
                        | Scheduled: <t t-esc="state.picking?.scheduled_date"/>
                    </p>
                </div>
                <button class="btn btn-secondary" t-on-click="() => this.closeWizard()">
                    Close
                </button>
            </div>

            <div class="putaway_body">
                <!-- Left Panel: Move Lines -->
                <div class="putaway_move_lines">
                    <h5>üì¶ Products to Put Away</h5>
                    <div class="move_line_list">
                        <div t-foreach="state.moveLines" t-as="ml" t-key="ml.id"
                             class="move_line_item"
                             t-att-class="state.selectedMoveLine?.id === ml.id ? 'selected' : ''"
                             t-on-click="() => this.selectMoveLine(ml)">
                            <div class="move_line_info">
                                <strong t-esc="ml.product_id[1]"/>
                                <div class="text-muted small">
                                    <span t-if="ml.lot_name">Lot: <t t-esc="ml.lot_name"/> | </span>
                                    Qty: <t t-esc="ml.reserved_uom_qty"/> <t t-esc="ml.product_uom_id[1]"/>
                                </div>
                            </div>
                            <div class="move_line_status">
                                <span t-if="ml.warehouse_bin_assigned" class="badge bg-success">
                                    ‚úì <t t-esc="ml.assigned_bin_id[1]"/>
                                </span>
                                <span t-else="" class="badge bg-warning">
                                    Pending
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 alert alert-info">
                        <strong>üìå How it works:</strong><br/>
                        1. Select a product<br/>
                        2. Click a bin in warehouse view<br/>
                        3. Confirm assignment<br/>
                        4. Close and validate picking normally
                    </div>
                </div>

                <!-- Center: Warehouse Canvas -->
                <div class="putaway_warehouse">
                    <div class="warehouse_controls">
                        <select class="form-select form-select-sm" t-model="state.filterArea" 
                                t-on-change="() => this.loadWarehouseData()">
                            <option value="">All Areas</option>
                            <!-- Areas populated dynamically -->
                        </select>
                        
                        <span t-if="state.selectedMoveLine" class="badge bg-primary">
                            Assigning: <t t-esc="state.selectedMoveLine.product_id[1]"/>
                        </span>
                    </div>
                    
                    <canvas id="putaway_canvas" width="800" height="600"></canvas>
                    
                    <div class="canvas_legend">
                        <div><span class="color_box bin_empty"></span> Empty</div>
                        <div><span class="color_box bin_available"></span> Available</div>
                        <div><span class="color_box bin_full"></span> Full</div>
                        <div><span class="color_box" style="background: #FFD700;"></span> Selected</div>
                    </div>
                </div>

                <!-- Right Panel: Bin Detail -->
                <div class="putaway_bin_detail" id="putaway_bin_detail">
                    <div class="text-center text-muted">
                        <p>üëà Select product, then click bin</p>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="putaway_footer">
                <div class="footer_info">
                    <strong>Progress:</strong>
                    <t t-set="assigned" t-value="state.moveLines.filter(ml => ml.warehouse_bin_assigned).length"/>
                    <t t-set="total" t-value="state.moveLines.length"/>
                    <span class="badge bg-info"><t t-esc="assigned"/> / <t t-esc="total"/> assigned</span>
                </div>
                <div class="footer_actions">
                    <button class="btn btn-primary" t-on-click="() => this.closeWizard()">
                        ‚úÖ Done - Return to Picking
                    </button>
                </div>
            </div>
        </div>
    </t>

    <!-- UNIFIED WAREHOUSE VIEW with 2D/3D Toggle -->
    <t t-name="hdi_warehouse_3d.warehouse_unified_view">
        <div class="warehouse_unified_container">
            <!-- Toggle Switch Header -->
            <div class="unified_header">
                <div class="mode_toggle_container">
                    <div class="mode_toggle">
                        <button 
                            class="toggle_btn"
                            t-att-class="state.mode === '2d' ? 'active' : ''"
                            t-on-click="() => this.switchTo2D()">
                            2D
                        </button>
                        <button 
                            class="toggle_btn"
                            t-att-class="state.mode === '3d' ? 'active' : ''"
                            t-on-click="() => this.switchTo3D()">
                            3D
                        </button>
                        <div class="toggle_slider" t-att-class="state.mode === '3d' ? 'right' : 'left'"></div>
                    </div>
                </div>
                
                <div class="mode_description">
                    <span t-if="state.mode === '2d'" class="badge bg-warning">
                        üèóÔ∏è Design Mode: Edit layout structure
                    </span>
                    <span t-if="state.mode === '3d'" class="badge bg-info">
                        üì¶ Operations Mode: Work with inventory
                    </span>
                </div>
            </div>

            <!-- Content Area -->
            <div class="unified_content">
                <!-- 2D Designer View -->
                <div t-if="state.mode === '2d'" class="mode_content">
                    <t t-if="!state.isManager">
                        <div class="alert alert-warning text-center">
                            <h4>‚ö†Ô∏è Access Restricted</h4>
                            <p>2D Designer mode requires Stock Manager permissions.</p>
                            <p>Contact your administrator to grant access.</p>
                        </div>
                    </t>
                    <t t-else="">
                        <!-- Embed 2D Designer Component -->
                        <div class="embedded_2d_designer">
                            <Warehouse2DDesigner t-props="state"/>
                        </div>
                    </t>
                </div>

                <!-- 3D Viewer View -->
                <div t-if="state.mode === '3d'" class="mode_content">
                    <!-- Embed 3D Viewer Component -->
                    <div class="embedded_3d_viewer">
                        <Warehouse3DViewer t-props="state"/>
                    </div>
                </div>
            </div>
        </div>
    </t>
</templates>
