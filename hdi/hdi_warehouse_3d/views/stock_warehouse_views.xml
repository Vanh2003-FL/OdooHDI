<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Extend Stock Warehouse Form with Layout Fields -->
    <record id="view_warehouse_form_3d" model="ir.ui.view">
        <field name="name">stock.warehouse.form.3d</field>
        <field name="model">stock.warehouse</field>
        <field name="inherit_id" ref="stock.view_warehouse"/>
        <field name="arch" type="xml">
            
            <!-- Add buttons in header -->
            <xpath expr="//header" position="inside">
                <button name="create_default_layout" string="Create 3D Layout" type="object" 
                        class="btn-primary" icon="fa-cube"
                        attrs="{'invisible': [('layout_id', '!=', False)]}"/>
                <button name="get_layout_info" string="View 3D Layout" type="object" 
                        class="btn-secondary" icon="fa-eye"
                        attrs="{'invisible': [('layout_id', '=', False)]}"/>
            </xpath>
            
            <!-- Add smart button for layout -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="%(action_warehouse_layout)d" type="action" 
                        class="oe_stat_button" icon="fa-cube"
                        attrs="{'invisible': [('layout_id', '=', False)]}">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_text">3D Layout</span>
                    </div>
                </button>
            </xpath>
            
            <!-- Add 3D Layout Configuration page -->
            <xpath expr="//notebook" position="inside">
                <page string="3D Visualization" name="visualization_3d" groups="stock.group_stock_manager">
                    <group>
                        <group string="Layout Configuration">
                            <field name="layout_id" options="{'no_create': True}"/>
                            <field name="enable_3d_view"/>
                            <field name="enable_2d_view"/>
                            <field name="default_view" widget="radio"
                                   attrs="{'invisible': [('enable_3d_view', '=', False), ('enable_2d_view', '=', False)]}"/>
                        </group>
                        <group string="Performance">
                            <field name="max_bins_to_render"/>
                        </group>
                    </group>
                    <div class="alert alert-info" role="alert" attrs="{'invisible': [('layout_id', '!=', False)]}">
                        <p><i class="fa fa-info-circle"/> Click "Create 3D Layout" to set up warehouse visualization.</p>
                    </div>
                </page>
            </xpath>
            
        </field>
    </record>
    
</odoo>
