<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Bin List View (Standalone) -->
    <record id="view_stock_location_tree_bins" model="ir.ui.view">
        <field name="name">stock.location.tree.bins</field>
        <field name="model">stock.location</field>
        <field name="arch" type="xml">
            <list string="Warehouse Bins" create="true" delete="false">
                <field name="name"/>
                <field name="location_type" widget="badge"/>
                <field name="bin_level"/>
                <field name="bin_row"/>
                <field name="bin_col"/>
                <field name="barcode"/>
                <field name="bin_state" widget="badge"/>
                <field name="is_locked" widget="badge"/>
            </list>
        </field>
    </record>

    <!-- Bin Form View (Standalone) -->
    <record id="view_stock_location_form_bins" model="ir.ui.view">
        <field name="name">stock.location.form.bins</field>
        <field name="model">stock.location</field>
        <field name="arch" type="xml">
            <form string="Create Bin">
                <sheet>
                    <!-- Alert for manual bin creation -->
                    <div class="alert alert-info" role="alert" invisible="id">
                        <strong>üí° Best Practice: Auto-Generate BINs</strong><br/>
                        Create a <strong>Shelf</strong> first and set level_count &amp; bins_per_level.<br/>
                        BINs will auto-generate automatically with correct parent assignment.
                    </div>
                    
                    <!-- Alert for locked bins -->
                    <div class="alert alert-danger" role="alert" invisible="not is_locked">
                        <strong>üîí LOCKED BIN (Has Inventory)</strong><br/>
                        Cannot move/resize/delete. ‚úÖ Allowed: Block/Unblock only.
                    </div>
                    
                    <!-- PRIMARY SECTION: BIN Assignment -->
                    <group string="üü¶ BIN Assignment to SHELF" colspan="4">
                        <field name="location_type" widget="selection" invisible="1" default="bin"/>
                        
                        <!-- Required: Shelf Selection -->
                        <group>
                            <field name="location_id" required="1" 
                                   domain="[('location_type', '=', 'shelf')]" 
                                   options="{'no_create': True}"
                                   help="MANDATORY: Select the parent SHELF for this BIN. BIN must always belong to exactly one SHELF."
                                   style="width: 100%;"/>
                        </group>
                        
                        <!-- Required: BIN Name -->
                        <group>
                            <field name="name" required="1" placeholder="e.g., SA1-L1-C1"
                                   help="BIN identifier (auto-suggested as {SHELF_CODE}-L{level}-C{col})"/>
                        </group>
                    </group>
                    
                    <!-- SECONDARY SECTION: Grid Position -->
                    <group string="Grid Position in SHELF" colspan="4">
                        <group>
                            <field name="bin_level" required="1" help="Vertical level (1=bottom)"/>
                            <field name="bin_row" required="1" help="Row position in shelf grid"/>
                            <field name="bin_col" required="1" help="Column position in shelf grid"/>
                        </group>
                        <group>
                            <field name="bin_state" widget="badge" readonly="1"/>
                            <field name="is_locked" widget="badge" readonly="1" invisible="not is_locked"/>
                        </group>
                    </group>
                    
                    <!-- TERTIARY SECTION: Dimensions & Capacity -->
                    <group string="Physical Dimensions" colspan="4">
                        <group>
                            <field name="bin_width" readonly="1" help="Auto-calculated from SHELF width"/>
                            <field name="bin_depth" readonly="1" help="Auto-calculated from SHELF depth"/>
                            <field name="bin_height" readonly="1" help="Auto-calculated from SHELF depth"/>
                        </group>
                        <group>
                            <field name="pos_x" help="X position in warehouse coordinates"/>
                            <field name="pos_y" help="Y position in warehouse coordinates"/>
                        </group>
                    </group>
                    
                    <!-- QUATERNARY SECTION: Capacity & Status -->
                    <group string="Capacity &amp; Inventory Status" colspan="4">
                        <group>
                            <field name="max_capacity"/>
                            <field name="max_weight"/>
                        </group>
                        <group>
                            <field name="is_blocked" widget="boolean_toggle"/>
                            <field name="block_reason" invisible="not is_blocked" nolabel="1" colspan="2"/>
                            <field name="display_color_code" widget="color"/>
                        </group>
                    </group>
                    
                    <!-- Advanced: Barcode (Optional) -->
                    <group string="Additional Info" colspan="4" id="advanced_section">
                        <group>
                            <field name="barcode" help="Optional: Barcode for scanning"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Bins Action (filtered stock.location) -->
    <record id="action_warehouse_bins" model="ir.actions.act_window">
        <field name="name">Bins</field>
        <field name="res_model">stock.location</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_stock_location_tree_bins"/>
        <field name="domain">[('location_type', '=', 'bin')]</field>
        <field name="context">{
            'default_location_type': 'bin',
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new Bin
            </p>
            <p>
                <strong>üí° Recommended Method:</strong> Create bins automatically by creating a <strong>Shelf</strong> first.<br/>
                When you create a Shelf with level_count and bins_per_level, all bins are auto-generated.<br/><br/>
                
                <strong>Manual Bin Creation (Advanced):</strong>
                <ol>
                    <li><strong>‚ö†Ô∏è FIRST: Select Parent SHELF</strong> - Bin position MUST be within this shelf!
                        <ul>
                            <li>Shelf boundaries: X = [pos_x, pos_x + width], Y = [pos_y, pos_y + height]</li>
                            <li>Bin must fit completely within shelf area</li>
                        </ul>
                    </li>
                    <li>Fill in required fields:
                        <ul>
                            <li><strong>Name</strong> (Location Name) - e.g., "BIN-R1-C1-L1"</li>
                            <li><strong>Bin Level</strong> - which level (1, 2, 3, 4...)</li>
                            <li><strong>Bin Row</strong> - row position within shelf</li>
                            <li><strong>Bin Column</strong> - column position within shelf</li>
                        </ul>
                    </li>
                    <li>Set Position &amp; Dimensions:
                        <ul>
                            <li><strong>pos_x, pos_y</strong> - coordinate (MUST be within shelf bounds!)</li>
                            <li><strong>bin_width, bin_depth, bin_height</strong> - physical size</li>
                        </ul>
                    </li>
                    <li>Save ‚Üí barcode auto-calculates</li>
                </ol>
                <br/>
                <strong>‚ùå Position Validation:</strong> System will reject if BIN coordinates fall outside parent SHELF area.
            </p>
        </field>
    </record>
</odoo>
