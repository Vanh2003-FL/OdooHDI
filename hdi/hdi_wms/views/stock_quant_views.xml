<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ‚úÖ INHERIT stock.quant tree - add batch_id field -->
    <record id="view_quant_tree_wms" model="ir.ui.view">
        <field name="name">stock.quant.tree.wms</field>
        <field name="model">stock.quant</field>
        <field name="inherit_id" ref="stock.view_stock_quant_tree"/>
        <field name="arch" type="xml">
            <field name="location_id" position="after">
                <field name="batch_id" optional="hide" groups="hdi_wms.group_wms_user"/>
            </field>
        </field>
    </record>

    <!-- ‚úÖ WMS Inventory Check Tree - KK_NV_01 (Batch) -->
    <record id="view_wms_inventory_check_batch_tree" model="ir.ui.view">
        <field name="name">wms.inventory.check.batch.tree</field>
        <field name="model">stock.quant</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <tree string="Ki·ªÉm k√™ theo Batch" editable="bottom" create="1" delete="1" default_order="location_id, product_id">
                <field name="check_type" invisible="1"/>
                <field name="location_id" domain="[('usage', 'in', ['internal', 'transit'])]" required="1"/>
                <field name="batch_id" 
                       domain="[('location_id', '=', location_id)]" 
                       required="1"
                       options="{'no_create': True}"/>
                <field name="product_id" readonly="1" options="{'no_create': True}"/>
                <field name="lot_id" groups="stock.group_production_lot" readonly="1" optional="hide"/>
                <field name="package_id" groups="stock.group_tracking_lot" readonly="1" optional="hide"/>
                <field name="quantity" string="S·ªë l∆∞·ª£ng h·ªá th·ªëng" readonly="1"/>
                <field name="inventory_quantity" string="S·ªë l∆∞·ª£ng ki·ªÉm ƒë·∫øm" required="1"/>
                <field name="inventory_diff_quantity" 
                       string="Ch√™nh l·ªách" 
                       readonly="1"
                       decoration-danger="inventory_diff_quantity &lt; 0"
                       decoration-success="inventory_diff_quantity &gt; 0"/>
                <field name="product_uom_id" groups="uom.group_uom" optional="hide"/>
                <button name="action_apply_inventory" 
                        type="object" 
                        string="√Åp d·ª•ng" 
                        class="btn-primary" 
                        icon="fa-save"/>
            </tree>
        </field>
    </record>

    <!-- ‚úÖ WMS Inventory Check Tree - KK_NV_02 (Barcode) -->
    <record id="view_wms_inventory_check_barcode_tree" model="ir.ui.view">
        <field name="name">wms.inventory.check.barcode.tree</field>
        <field name="model">stock.quant</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <tree string="Ki·ªÉm k√™ qu√©t Barcode" editable="bottom" create="1" delete="1" default_order="location_id, product_id">
                <field name="check_type" invisible="1"/>
                <field name="location_id" domain="[('usage', 'in', ['internal', 'transit'])]" required="1"/>
                <field name="product_id" options="{'no_create': True}"/>
                <field name="lot_id" groups="stock.group_production_lot" optional="hide"/>
                <field name="scan_mode" 
                       widget="boolean_toggle" 
                       string="üîç Ch·∫ø ƒë·ªô qu√©t"/>
                <field name="last_scanned_code" 
                       readonly="1"
                       string="M√£ v·ª´a qu√©t"
                       placeholder="Ch∆∞a qu√©t..."/>
                <field name="scanned_count" 
                       readonly="1"
                       string="L·∫ßn qu√©t"
                       decoration-info="scanned_count &gt; 0"/>
                <field name="quantity" string="S·ªë l∆∞·ª£ng h·ªá th·ªëng" readonly="1"/>
                <field name="inventory_quantity" string="S·ªë l∆∞·ª£ng ki·ªÉm ƒë·∫øm" required="1"/>
                <field name="inventory_diff_quantity" 
                       string="Ch√™nh l·ªách" 
                       readonly="1"
                       decoration-danger="inventory_diff_quantity &lt; 0"
                       decoration-success="inventory_diff_quantity &gt; 0"/>
                <field name="product_uom_id" groups="uom.group_uom" optional="hide"/>
                <button name="action_apply_inventory" 
                        type="object" 
                        string="√Åp d·ª•ng" 
                        class="btn-primary" 
                        icon="fa-save"/>
            </tree>
        </field>
    </record>

    <!-- ‚úÖ Action: KK_NV_01 - Ki·ªÉm k√™ theo Batch -->
    <record id="action_wms_inventory_check_batch" model="ir.actions.act_window">
        <field name="name">KK_NV_01 - Ki·ªÉm k√™ theo Batch</field>
        <field name="res_model">stock.quant</field>
        <field name="view_mode">list</field>
        <field name="view_id" ref="view_wms_inventory_check_batch_tree"/>
        <field name="domain">[('check_type', '=', 'batch')]</field>
        <field name="context">{'default_check_type': 'batch', 'inventory_mode': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                T·∫°o phi·∫øu ki·ªÉm k√™ theo Batch/LPN
            </p>
            <p>
                Ch·ªçn v·ªã tr√≠ kho v√† Batch/LPN c·∫ßn ki·ªÉm k√™.<br/>
                H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông l·∫•y danh s√°ch s·∫£n ph·∫©m trong batch ƒë√≥.
            </p>
        </field>
    </record>

    <!-- ‚úÖ Action: KK_NV_02 - Ki·ªÉm k√™ theo Barcode -->
    <record id="action_wms_inventory_check_barcode" model="ir.actions.act_window">
        <field name="name">KK_NV_02 - Ki·ªÉm k√™ qu√©t Barcode</field>
        <field name="res_model">stock.quant</field>
        <field name="view_mode">list</field>
        <field name="view_id" ref="view_wms_inventory_check_barcode_tree"/>
        <field name="domain">[('check_type', '=', 'barcode')]</field>
        <field name="context">{'default_check_type': 'barcode', 'inventory_mode': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                T·∫°o phi·∫øu ki·ªÉm k√™ b·∫±ng qu√©t Barcode
            </p>
            <p>
                B·∫≠t ch·∫ø ƒë·ªô qu√©t v√† d√πng m√°y qu√©t barcode ƒë·ªÉ ki·ªÉm ƒë·∫øm t·ª´ng s·∫£n ph·∫©m.<br/>
                M·ªói l·∫ßn qu√©t s·∫Ω t·ª± ƒë·ªông tƒÉng s·ªë l∆∞·ª£ng.
            </p>
        </field>
    </record>

</odoo>

