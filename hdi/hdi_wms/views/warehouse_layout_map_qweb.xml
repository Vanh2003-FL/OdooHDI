<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ===== WAREHOUSE LAYOUT MAP VISUALIZATION ===== -->
    <record id="view_warehouse_layout_map_qweb" model="ir.ui.view">
        <field name="name">hdi.warehouse.layout.map</field>
        <field name="model">hdi.warehouse.layout</field>
        <field name="type">qweb</field>
        <field name="arch" type="xml">
            <t t-name="hdi_wms.warehouse_layout_map_view">
                <div class="warehouse-map-container">
                    <!-- Header v·ªõi th√¥ng tin kho -->
                    <div class="warehouse-map-header">
                        <div class="header-top">
                            <div class="header-title">
                                <h1><t t-esc="record.name"/></h1>
                                <p class="warehouse-name"><i class="fa fa-building-o"></i> <t t-esc="record.warehouse_id.name"/></p>
                            </div>
                            <div class="header-stats">
                                <div class="stat-item">
                                    <span class="stat-label">K√≠ch th∆∞·ªõc</span>
                                    <span class="stat-value"><t t-esc="record.rows"/> √ó <t t-esc="record.columns"/> √ó <t t-esc="record.levels"/></span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">S·ª≠ d·ª•ng</span>
                                    <span class="stat-value"><t t-esc="record.utilization_rate"/>%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Slot</span>
                                    <span class="stat-value"><t t-esc="record.occupied_slots"/>/<t t-esc="record.total_slots"/></span>
                                </div>
                            </div>
                        </div>
                        <div class="header-controls">
                            <input type="text" placeholder="üîç T√¨m ki·∫øm theo l√¥ h√†ng..." class="search-input" />
                            <div class="zoom-controls">
                                <button class="zoom-btn" data-zoom="minus">‚àí</button>
                                <span class="zoom-level">100%</span>
                                <button class="zoom-btn" data-zoom="plus">+</button>
                            </div>
                        </div>
                    </div>

                    <!-- Legend -->
                    <div class="warehouse-map-legend">
                        <h3 class="legend-title">Ch·ªâ s·ªë t·ªìn kho</h3>
                        <div class="legend-grid">
                            <div class="legend-item">
                                <div class="legend-color green"></div>
                                <span>B√¨nh th∆∞·ªùng (0-60 ng√†y)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color orange"></div>
                                <span>C·∫£nh b√°o (61-90 ng√†y)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color red"></div>
                                <span>T·ªìn l√¢u (&gt;90 ng√†y)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color white"></div>
                                <span>Tr·ªëng</span>
                            </div>
                        </div>
                    </div>

                    <!-- Grid Map -->
                    <div class="warehouse-grid-wrapper" id="grid-wrapper">
                        <div class="grid-toolbar">
                            <span class="grid-coords">K√≠ch th∆∞·ªõc l∆∞·ªõi: <strong><t t-esc="record.rows"/> √ó <t t-esc="record.columns"/></strong></span>
                            <div class="grid-actions">
                                <button class="action-btn" title="L√†m m·ªõi"><i class="fa fa-refresh"></i></button>
                                <button class="action-btn" title="T·∫£i xu·ªëng"><i class="fa fa-download"></i></button>
                            </div>
                        </div>
                        <div class="warehouse-grid" t-attf-data-cols="#{record.columns}" t-attf-style="grid-template-columns: repeat(#{record.columns}, 1fr);">
                            <t t-foreach="record.location_grid_ids" t-as="grid_location">
                                <t t-set="has_quant" t-value="bool(grid_location.batch_id)"/>
                                <t t-set="days_value" t-value="grid_location.batch_id.days_in_warehouse if grid_location.batch_id else 0"/>
                                <t t-set="badge_class" t-value="'badge-green'"/>
                                <t t-if="days_value > 90">
                                    <t t-set="badge_class" t-value="'badge-red blink'"/>
                                </t>
                                <t t-elif="days_value > 60">
                                    <t t-set="badge_class" t-value="'badge-orange'"/>
                                </t>

                                <div t-attf-class="grid-cell #{has_quant and 'occupied' or 'empty'}" 
                                     t-attf-data-id="#{grid_location.id}"
                                     t-attf-data-x="#{grid_location.column}"
                                     t-attf-data-y="#{grid_location.row}"
                                     t-attf-data-location-id="#{grid_location.id}">
                                    <t t-if="has_quant">
                                        <div class="quant-cell" t-attf-data-batch-id="#{grid_location.batch_id.id}">
                                            <div t-attf-class="quant-badge #{badge_class}" t-attf-title="T·ªìn #{days_value} ng√†y">
                                                <t t-esc="days_value"/><span class="badge-text">d</span>
                                            </div>
                                            <div class="quant-info">
                                                <div class="quant-lot" t-attf-title="#{grid_location.batch_id.lot_id.name if grid_location.batch_id.lot_id else 'Kh√¥ng c√≥ l√¥'}">
                                                    <strong>
                                                        <t t-if="grid_location.batch_id.lot_id">
                                                            <t t-esc="grid_location.batch_id.lot_id.name"/>
                                                        </t>
                                                        <t t-else="">‚àí</t>
                                                    </strong>
                                                </div>
                                                <div class="quant-product" t-attf-title="#{grid_location.batch_id.product_id.name}">
                                                    <t t-esc="grid_location.batch_id.product_id.name[:20]"/>
                                                </div>
                                                <div class="quant-qty">
                                                    <span class="qty-total"><t t-esc="int(grid_location.batch_id.quantity)"/></span>
                                                    <span class="qty-available">(<t t-esc="int(grid_location.batch_id.quantity - grid_location.batch_id.reserved_quantity)"/>)</span>
                                                </div>
                                            </div>
                                            <div class="cell-actions">
                                                <button class="cell-action-btn edit" title="Ch·ªânh s·ª≠a"><i class="fa fa-pencil"></i></button>
                                                <button class="cell-action-btn move" title="Di chuy·ªÉn"><i class="fa fa-arrows"></i></button>
                                                <button class="cell-action-btn remove" title="X√≥a"><i class="fa fa-trash"></i></button>
                                            </div>
                                        </div>
                                    </t>
                                    <t t-else="">
                                        <div class="empty-cell" title="Nh·∫•n ƒë·ªÉ th√™m h√†ng">+</div>
                                    </t>
                                </div>
                            </t>
                        </div>
                    </div>

                    <!-- Footer Statistics -->
                    <div class="warehouse-map-footer">
                        <div class="footer-section">
                            <h3>Th·ªëng k√™ kho</h3>
                            <div class="footer-stats">
                                <div class="footer-stat">
                                    <span class="stat-icon"><i class="fa fa-cube"></i></span>
                                    <div>
                                        <span class="stat-name">T·ªïng slot</span>
                                        <span class="stat-big"><t t-esc="record.total_slots"/></span>
                                    </div>
                                </div>
                                <div class="footer-stat">
                                    <span class="stat-icon"><i class="fa fa-check-circle" style="color: #28a745;"></i></span>
                                    <div>
                                        <span class="stat-name">S·ª≠ d·ª•ng</span>
                                        <span class="stat-big"><t t-esc="record.occupied_slots"/></span>
                                    </div>
                                </div>
                                <div class="footer-stat">
                                    <span class="stat-icon"><i class="fa fa-circle-o" style="color: #ddd;"></i></span>
                                    <div>
                                        <span class="stat-name">Tr·ªëng</span>
                                        <span class="stat-big"><t t-esc="record.empty_slots"/></span>
                                    </div>
                                </div>
                                <div class="footer-stat">
                                    <span class="stat-icon"><i class="fa fa-bar-chart"></i></span>
                                    <div>
                                        <span class="stat-name">Hi·ªáu su·∫•t</span>
                                        <span class="stat-big"><t t-esc="record.utilization_rate"/>%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </field>
    </record>

</odoo>

