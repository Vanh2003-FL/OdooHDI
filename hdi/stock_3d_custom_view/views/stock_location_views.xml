<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="view_location_form" model="ir.ui.view">
        <field name="name">stock.location.view.form.inherit.stock_3d_custom_view
        </field>
        <field name="model">stock.location</field>
        <field name="inherit_id" ref="stock.view_location_form"/>
        <field name="arch" type="xml">
            <!--adding 3D buttons in stock.location form view-->
            <xpath expr="//sheet" position="before">
                <header>
                    <button type="object" name="action_view_location_3d_button"
                            string="Preview Location 3D" 
                            id="view_location_3d_button"
                            class="btn btn-primary"
                            invisible="not location_id or (loc_length == 0 and loc_width == 0)"/>
                    <button type="object" name="action_view_warehouse_3d_map"
                            string="View Warehouse 3D Map" 
                            id="view_warehouse_3d_map_button"
                            class="btn btn-info"
                            help="View all products in 3D with warehouse_map positions"/>
                </header>
            </xpath>
            
            <!--adding location dimension fields in stock.location form view-->
            <xpath expr="//sheet" position="inside">
                <notebook>
                    <page string="3D Visualization Properties"
                          invisible="usage != 'internal'">
                        <group>
                            <group string="3D Box Dimensions (for location boxes)">
                                <field name="loc_length"/>
                                <field name="loc_width"/>
                                <field name="loc_height"/>
                            </group>
                            <group string="3D Box Position">
                                <field name="loc_pos_x"/>
                                <field name="loc_pos_y"/>
                                <field name="loc_pos_z"/>
                            </group>
                        </group>
                        <group>
                            <group string="Other 3D Properties">
                                <field name="loc_3d_code"/>
                                <field name="loc_max_capacity"/>
                            </group>
                            <group>
                                <div class="alert alert-info" role="alert">
                                    <strong>Note:</strong> These fields are for 3D visualization of location boxes (shelves/racks).
                                    Product positions come from warehouse_map module (posx, posy, posz in stock.quant).
                                </div>
                            </group>
                        </group>
                    </page>
                </notebook>
            </xpath>
        </field>
    </record>
    
    <!--client action for legacy 3d view of locations-->
    <record id="stock_location_3d_action" model="ir.actions.client">
        <field name="name">Location 3D View (Legacy)</field>
        <field name="tag">open_form_3d_view</field>
    </record>
    
    <!--client action for new integrated warehouse 3d view-->
    <record id="warehouse_3d_map_action" model="ir.actions.client">
        <field name="name">Warehouse 3D Map</field>
        <field name="tag">warehouse_3d_view_action_v18</field>
    </record>
    
    <!-- Menu item for warehouse 3D view -->
    <menuitem id="menu_warehouse_3d_view"
              name="Warehouse 3D View"
              parent="stock.menu_stock_warehouse_mgmt"
              action="warehouse_3d_map_action"
              sequence="50"/>
    
    <data>
        <!--adding button to open 3d view in stock.location tree view-->
        <record id="view_location_tree2" model="ir.ui.view">
            <field name="name">stock.location.view.tree.inherit.stock_3d_custom_view
            </field>
            <field name="model">stock.location</field>
            <field name="inherit_id" ref="stock.view_location_tree2"/>
            <field name="arch" type="xml">
                <xpath expr="//list" position="attributes">
                    <attribute name="js_class">3d_button_in_stock</attribute>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
